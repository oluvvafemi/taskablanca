.card.mb-2.shadow-sm{ id: dom_id(task) }
  .card-body.p-3
    %h6.card-title= task.title
    %p.card-text.small.text-muted= truncate(task.description, length: 100)
    .d-flex.justify-content-between.align-items-center.mt-2
      .small
        - if task.users.any?
          %i.bi.bi-person.me-1
          = task.users.map(&:name).join(", ")
        - else
          %span.text-muted Unassigned
      .d-flex.gap-1
        - if task.users.include?(Current.user)
          = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark", data: { turbo_frame: "edit_task" }, title: "Edit task" do
            %i.bi.bi-pencil
          - if task.status == "todo"
            = button_to task_path(task), method: :patch, params: { task: { status: "in_progress" } }, class: "btn btn-sm btn-outline-primary", title: "Start task" do
              %i.bi.bi-play
            = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success", title: "Finish task" do
              %i.bi.bi-check
          - elsif task.status == "in_progress"
            = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning", title: "Restart task" do
              %i.bi.bi-arrow-counterclockwise
            = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success", title: "Finish task" do
              %i.bi.bi-check
          - elsif task.status == "done"
            = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning", title: "Restart task" do
              %i.bi.bi-arrow-counterclockwise
        - else
          = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark disabled", data: { turbo_frame: "edit_task" }, style: "opacity: 0.5; pointer-events: none;", title: "Edit task" do
            %i.bi.bi-pencil
          - if task.status == "todo"
            = button_to task_path(task), method: :patch, params: { task: { status: "in_progress" } }, class: "btn btn-sm btn-outline-primary disabled", style: "opacity: 0.5; pointer-events: none;", title: "Start task" do
              %i.bi.bi-play
            = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success disabled", style: "opacity: 0.5; pointer-events: none;", title: "Finish task" do
              %i.bi.bi-check
          - elsif task.status == "in_progress"
            = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning disabled", style: "opacity: 0.5; pointer-events: none;", title: "Restart task" do
              %i.bi.bi-arrow-counterclockwise
            = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success disabled", style: "opacity: 0.5; pointer-events: none;", title: "Finish task" do
              %i.bi.bi-check
          - elsif task.status == "done"
            = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning disabled", style: "opacity: 0.5; pointer-events: none;", title: "Restart task" do
              %i.bi.bi-arrow-counterclockwise
