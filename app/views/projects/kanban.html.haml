.d-flex.justify-content-between.align-items-center.mb-3
  .d-flex.align-items-center
    = link_to projects_path, class: "btn btn-outline-secondary btn-sm me-3" do
      %i.bi.bi-arrow-left
    %div
      %h4.h5.mb-1= @project.title
      %span.badge.bg-light.text-dark.small= @project.organization.name
  .d-flex.gap-2
    = link_to project_path(@project), class: "btn btn-outline-dark btn-sm" do
      %i.bi.bi-list.me-1
      List View
    = link_to edit_project_path(@project), class: "btn btn-outline-dark btn-sm" do
      %i.bi.bi-pencil.me-1
      Edit

- if @project.description.present?
  .card.shadow-sm.mb-3
    .card-body.py-2
      %small.text-muted= @project.description

.d-flex.justify-content-between.align-items-center.mb-3
  %h5.mb-0
    %i.bi.bi-kanban.me-2
    Kanban Board
    %span.badge.bg-secondary.ms-2= @tasks.count
  = link_to new_task_path(project_id: @project.id), class: "btn btn-dark btn-sm", data: { turbo_frame: dom_id(Task.new) } do
    %i.bi.bi-plus-lg.me-1
    New Task

= turbo_frame_tag Task.new

.row.g-3
  .col-md-4
    .card.h-100
      .card-header.bg-secondary.text-white.d-flex.justify-content-between.align-items-center
        %h6.mb-0
          %i.bi.bi-list-ul.me-2
          To Do
        %span.badge.bg-light.text-dark= @todo_tasks.count
      .card-body.p-2
        - if @todo_tasks.any?
          - @todo_tasks.each do |task|
            .card.mb-2.shadow-sm
              .card-body.p-3
                %h6.card-title= task.title
                %p.card-text.small.text-muted= truncate(task.description, length: 100)
                .d-flex.justify-content-between.align-items-center.mt-2
                  .small
                    - if task.users.any?
                      %i.bi.bi-person.me-1
                      = task.users.map(&:name).join(", ")
                    - else
                      %span.text-muted Unassigned
                  .d-flex.gap-1
                    - if task.users.include?(Current.user)
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark", data: { turbo_frame: "edit_task" }, title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "in_progress" } }, class: "btn btn-sm btn-outline-primary", title: "Start task" do
                        %i.bi.bi-play
                      = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success", title: "Finish task" do
                        %i.bi.bi-check
                    - else
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark disabled", data: { turbo_frame: "edit_task" }, style: "opacity: 0.5; pointer-events: none;", title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "in_progress" } }, class: "btn btn-sm btn-outline-primary disabled", style: "opacity: 0.5; pointer-events: none;", title: "Start task" do
                        %i.bi.bi-play
                      = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success disabled", style: "opacity: 0.5; pointer-events: none;", title: "Finish task" do
                        %i.bi.bi-check
        - else
          .text-center.text-muted.py-4
            %i.bi.bi-inbox.fs-1
            %p.mt-2 No tasks in this column

  .col-md-4
    .card.h-100
      .card-header.bg-dark.text-white.d-flex.justify-content-between.align-items-center
        %h6.mb-0
          %i.bi.bi-clock-history.me-2
          In Progress
        %span.badge.bg-light.text-dark= @in_progress_tasks.count
      .card-body.p-2
        - if @in_progress_tasks.any?
          - @in_progress_tasks.each do |task|
            .card.mb-2.shadow-sm
              .card-body.p-3
                %h6.card-title= task.title
                %p.card-text.small.text-muted= truncate(task.description, length: 100)
                .d-flex.justify-content-between.align-items-center.mt-2
                  .small
                    - if task.users.any?
                      %i.bi.bi-person.me-1
                      = task.users.map(&:name).join(", ")
                    - else
                      %span.text-muted Unassigned
                  .d-flex.gap-1
                    - if task.users.include?(Current.user)
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark", data: { turbo_frame: "edit_task" }, title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning", title: "Restart task" do
                        %i.bi.bi-arrow-counterclockwise
                      = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success", title: "Finish task" do
                        %i.bi.bi-check
                    - else
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark disabled", data: { turbo_frame: "edit_task" }, style: "opacity: 0.5; pointer-events: none;", title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning disabled", style: "opacity: 0.5; pointer-events: none;", title: "Restart task" do
                        %i.bi.bi-arrow-counterclockwise
                      = button_to task_path(task), method: :patch, params: { task: { status: "done" } }, class: "btn btn-sm btn-outline-success disabled", style: "opacity: 0.5; pointer-events: none;", title: "Finish task" do
                        %i.bi.bi-check
        - else
          .text-center.text-muted.py-4
            %i.bi.bi-inbox.fs-1
            %p.mt-2 No tasks in this column

  .col-md-4
    .card.h-100
      .card-header.bg-success.text-white.d-flex.justify-content-between.align-items-center
        %h6.mb-0
          %i.bi.bi-check-circle.me-2
          Done
        %span.badge.bg-light.text-dark= @done_tasks.count
      .card-body.p-2
        - if @done_tasks.any?
          - @done_tasks.each do |task|
            .card.mb-2.shadow-sm
              .card-body.p-3
                %h6.card-title= task.title
                %p.card-text.small.text-muted= truncate(task.description, length: 100)
                .d-flex.justify-content-between.align-items-center.mt-2
                  .small
                    - if task.users.any?
                      %i.bi.bi-person.me-1
                      = task.users.map(&:name).join(", ")
                    - else
                      %span.text-muted Unassigned
                  .d-flex.gap-1
                    - if task.users.include?(Current.user)
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark", data: { turbo_frame: "edit_task" }, title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning", title: "Restart task" do
                        %i.bi.bi-arrow-counterclockwise
                    - else
                      = link_to edit_task_path(task, project_id: task.project_id), class: "btn btn-sm btn-outline-dark disabled", data: { turbo_frame: "edit_task" }, style: "opacity: 0.5; pointer-events: none;", title: "Edit task" do
                        %i.bi.bi-pencil
                      = button_to task_path(task), method: :patch, params: { task: { status: "todo" } }, class: "btn btn-sm btn-outline-warning disabled", style: "opacity: 0.5; pointer-events: none;", title: "Restart task" do
                        %i.bi.bi-arrow-counterclockwise
        - else
          .text-center.text-muted.py-4
            %i.bi.bi-inbox.fs-1
            %p.mt-2 No tasks in this column

= turbo_frame_tag "edit_task"
